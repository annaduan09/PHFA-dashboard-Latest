"income_15k_20k" = "B19101_004",
"income_20k_25k" = "B19101_005",
"income_25k_30k" = "B19101_006",
"income_30k_35k" = "B19101_007",
"income_35k_40k" = "B19101_008",
"income_40k_45k" = "B19101_009",
"income_45k_50k" = "B19101_010",
"income_50k_60k" = "B19101_011",
"income_60k_75k" = "B19101_012",
"income_75k_100k" = "B19101_013",
"income_100k_125k" = "B19101_014",
"income_125k_150k" = "B19101_015",
"income_150k_200k" = "B19101_016",
"income_200k_plus" = "B19101_017",
"vacant_rental_units" = "B25004_002",
"internet_hh" = "B28002_002",
"med_year_built" = "B25035_001",
"med_home_value" = "B25107_001",
"medhhinc" = "B19013A_001",
"med_owner_costs_mortgaged" = "B25088_002",
"med_gross_rent" = "B25064_001"), year = yr, state = "PA",
geometry = FALSE, survey = "acs5", output = "wide") %>%
mutate(owner_occ_hh_pct = ifelse(total_hhE > 0, round(100*owner_occ_hhE/total_hhE), 0),
renter_occ_hh_pct = ifelse(total_hhE > 0, round(100*renter_occ_hhE/total_hhE), 0),
renter_vacant_pct = ifelse(renter_occ_hhE > 0, round(100*vacant_rental_unitsE/renter_occ_hhE), 0),
med_age_home = 2023-med_year_builtE,
internet_hh = ifelse(total_hhE > 0, round(100*internet_hhE/total_hhE), 0),
rent_burdened_pct = ifelse(med_gross_rentE*12 > 5000*.3, income_below10kE/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 12500*.3, (income_below10kE + income_10k_15kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 17500*.3, (income_below10kE + income_10k_15kE + income_15k_20kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 22500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 27500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 32500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 37500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 42500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 47500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 55000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 67500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 87500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 112500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 137500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 175000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_150k_200kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 162500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_200k_plusE)/(renter_occ_hhE *0.01),
0)))))))))))))))),
mortgage_burdened_pct = ifelse(med_owner_costs_mortgagedE*12 > 5000*.3, income_below10kE/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 12500*.3, (income_below10kE + income_10k_15kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 17500*.3, (income_below10kE + income_10k_15kE + income_15k_20kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 22500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 27500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 32500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 37500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 42500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 47500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 55000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 67500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 87500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 112500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 137500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 175000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_150k_200kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 162500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_200k_plusE)/(hh_with_mortgageE*0.01),
0)))))))))))))))),
county = word(NAME, 1)) %>%
rename(med_gross_rent = med_gross_rentE,
med_home_value = med_home_valueE) %>%
dplyr::select(county, owner_occ_hh_pct, renter_occ_hh_pct, renter_vacant_pct, med_age_home, med_home_value, internet_hh, rent_burdened_pct, mortgage_burdened_pct, med_gross_rent)
names(dat21)[-1] %<>% paste0("_21")
}
dat_21 <- get_dat(2021)
dat <- get_acs(geography = "county",
variables = c("owner_occ_hh" = "B25011_002",
"total_hh" = "B11007_001",
"renter_occ_hh" = "B25003_003",
"hh_with_mortgage" = "B25096_002",
"income_below10k" = "B19101_002",
"income_10k_15k" = "B19101_003",
"income_15k_20k" = "B19101_004",
"income_20k_25k" = "B19101_005",
"income_25k_30k" = "B19101_006",
"income_30k_35k" = "B19101_007",
"income_35k_40k" = "B19101_008",
"income_40k_45k" = "B19101_009",
"income_45k_50k" = "B19101_010",
"income_50k_60k" = "B19101_011",
"income_60k_75k" = "B19101_012",
"income_75k_100k" = "B19101_013",
"income_100k_125k" = "B19101_014",
"income_125k_150k" = "B19101_015",
"income_150k_200k" = "B19101_016",
"income_200k_plus" = "B19101_017",
"vacant_rental_units" = "B25004_002",
"internet_hh" = "B28002_002",
"med_year_built" = "B25035_001",
"med_home_value" = "B25107_001",
"medhhinc" = "B19013A_001",
"med_owner_costs_mortgaged" = "B25088_002",
"med_gross_rent" = "B25064_001"), year = yr, state = "PA",
geometry = FALSE, survey = "acs5", output = "wide") %>%
mutate(owner_occ_hh_pct = ifelse(total_hhE > 0, round(100*owner_occ_hhE/total_hhE), 0),
renter_occ_hh_pct = ifelse(total_hhE > 0, round(100*renter_occ_hhE/total_hhE), 0),
renter_vacant_pct = ifelse(renter_occ_hhE > 0, round(100*vacant_rental_unitsE/renter_occ_hhE), 0),
med_age_home = yr-med_year_builtE,
internet_hh = ifelse(total_hhE > 0, round(100*internet_hhE/total_hhE), 0),
rent_burdened_pct = ifelse(med_gross_rentE*12 > 5000*.3, income_below10kE/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 12500*.3, (income_below10kE + income_10k_15kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 17500*.3, (income_below10kE + income_10k_15kE + income_15k_20kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 22500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 27500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 32500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 37500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 42500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 47500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 55000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 67500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 87500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 112500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 137500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 175000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_150k_200kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 162500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_200k_plusE)/(renter_occ_hhE *0.01),
0)))))))))))))))),
mortgage_burdened_pct = ifelse(med_owner_costs_mortgagedE*12 > 5000*.3, income_below10kE/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 12500*.3, (income_below10kE + income_10k_15kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 17500*.3, (income_below10kE + income_10k_15kE + income_15k_20kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 22500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 27500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 32500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 37500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 42500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 47500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 55000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 67500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 87500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 112500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 137500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 175000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_150k_200kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 162500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_200k_plusE)/(hh_with_mortgageE*0.01),
0)))))))))))))))),
county = word(NAME, 1)) %>%
rename(med_gross_rent = med_gross_rentE,
med_home_value = med_home_valueE) %>%
dplyr::select(county, owner_occ_hh_pct, renter_occ_hh_pct, renter_vacant_pct, med_age_home, med_home_value, internet_hh, rent_burdened_pct, mortgage_burdened_pct, med_gross_rent)
get_dat <- function(yr){
dat <- get_acs(geography = "county",
variables = c("owner_occ_hh" = "B25011_002",
"total_hh" = "B11007_001",
"renter_occ_hh" = "B25003_003",
"hh_with_mortgage" = "B25096_002",
"income_below10k" = "B19101_002",
"income_10k_15k" = "B19101_003",
"income_15k_20k" = "B19101_004",
"income_20k_25k" = "B19101_005",
"income_25k_30k" = "B19101_006",
"income_30k_35k" = "B19101_007",
"income_35k_40k" = "B19101_008",
"income_40k_45k" = "B19101_009",
"income_45k_50k" = "B19101_010",
"income_50k_60k" = "B19101_011",
"income_60k_75k" = "B19101_012",
"income_75k_100k" = "B19101_013",
"income_100k_125k" = "B19101_014",
"income_125k_150k" = "B19101_015",
"income_150k_200k" = "B19101_016",
"income_200k_plus" = "B19101_017",
"vacant_rental_units" = "B25004_002",
"internet_hh" = "B28002_002",
"med_year_built" = "B25035_001",
"med_home_value" = "B25107_001",
"medhhinc" = "B19013A_001",
"med_owner_costs_mortgaged" = "B25088_002",
"med_gross_rent" = "B25064_001"), year = yr, state = "PA",
geometry = FALSE, survey = "acs5", output = "wide") %>%
mutate(owner_occ_hh_pct = ifelse(total_hhE > 0, round(100*owner_occ_hhE/total_hhE), 0),
renter_occ_hh_pct = ifelse(total_hhE > 0, round(100*renter_occ_hhE/total_hhE), 0),
renter_vacant_pct = ifelse(renter_occ_hhE > 0, round(100*vacant_rental_unitsE/renter_occ_hhE), 0),
med_age_home = yr-med_year_builtE,
internet_hh = ifelse(total_hhE > 0, round(100*internet_hhE/total_hhE), 0),
rent_burdened_pct = ifelse(med_gross_rentE*12 > 5000*.3, income_below10kE/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 12500*.3, (income_below10kE + income_10k_15kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 17500*.3, (income_below10kE + income_10k_15kE + income_15k_20kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 22500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 27500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 32500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 37500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 42500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 47500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 55000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 67500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 87500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 112500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 137500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 175000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_150k_200kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 162500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_200k_plusE)/(renter_occ_hhE *0.01),
0)))))))))))))))),
mortgage_burdened_pct = ifelse(med_owner_costs_mortgagedE*12 > 5000*.3, income_below10kE/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 12500*.3, (income_below10kE + income_10k_15kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 17500*.3, (income_below10kE + income_10k_15kE + income_15k_20kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 22500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 27500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 32500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 37500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 42500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 47500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 55000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 67500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 87500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 112500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 137500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 175000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_150k_200kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 162500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_200k_plusE)/(hh_with_mortgageE*0.01),
0)))))))))))))))),
county = word(NAME, 1)) %>%
rename(med_gross_rent = med_gross_rentE,
med_home_value = med_home_valueE) %>%
dplyr::select(county, owner_occ_hh_pct, renter_occ_hh_pct, renter_vacant_pct, med_age_home, med_home_value, internet_hh, rent_burdened_pct, mortgage_burdened_pct, med_gross_rent)
names(dat)[-1] %<>% paste0(yr)
}
dat_21 <- get_dat(2021)
dat21
dat_21
View(mapTheme)
get_dat <- function(yr){
dat <- get_acs(geography = "county",
variables = c("owner_occ_hh" = "B25011_002",
"total_hh" = "B11007_001",
"renter_occ_hh" = "B25003_003",
"hh_with_mortgage" = "B25096_002",
"income_below10k" = "B19101_002",
"income_10k_15k" = "B19101_003",
"income_15k_20k" = "B19101_004",
"income_20k_25k" = "B19101_005",
"income_25k_30k" = "B19101_006",
"income_30k_35k" = "B19101_007",
"income_35k_40k" = "B19101_008",
"income_40k_45k" = "B19101_009",
"income_45k_50k" = "B19101_010",
"income_50k_60k" = "B19101_011",
"income_60k_75k" = "B19101_012",
"income_75k_100k" = "B19101_013",
"income_100k_125k" = "B19101_014",
"income_125k_150k" = "B19101_015",
"income_150k_200k" = "B19101_016",
"income_200k_plus" = "B19101_017",
"vacant_rental_units" = "B25004_002",
"internet_hh" = "B28002_002",
"med_year_built" = "B25035_001",
"med_home_value" = "B25107_001",
"medhhinc" = "B19013A_001",
"med_owner_costs_mortgaged" = "B25088_002",
"med_gross_rent" = "B25064_001"), year = yr, state = "PA",
geometry = FALSE, survey = "acs5", output = "wide") %>%
mutate(owner_occ_hh_pct = ifelse(total_hhE > 0, round(100*owner_occ_hhE/total_hhE), 0),
renter_occ_hh_pct = ifelse(total_hhE > 0, round(100*renter_occ_hhE/total_hhE), 0),
renter_vacant_pct = ifelse(renter_occ_hhE > 0, round(100*vacant_rental_unitsE/renter_occ_hhE), 0),
med_age_home = yr-med_year_builtE,
internet_hh = ifelse(total_hhE > 0, round(100*internet_hhE/total_hhE), 0),
rent_burdened_pct = ifelse(med_gross_rentE*12 > 5000*.3, income_below10kE/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 12500*.3, (income_below10kE + income_10k_15kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 17500*.3, (income_below10kE + income_10k_15kE + income_15k_20kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 22500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 27500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 32500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 37500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 42500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 47500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 55000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 67500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 87500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 112500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 137500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 175000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_150k_200kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 162500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_200k_plusE)/(renter_occ_hhE *0.01),
0)))))))))))))))),
mortgage_burdened_pct = ifelse(med_owner_costs_mortgagedE*12 > 5000*.3, income_below10kE/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 12500*.3, (income_below10kE + income_10k_15kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 17500*.3, (income_below10kE + income_10k_15kE + income_15k_20kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 22500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 27500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 32500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 37500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 42500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 47500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 55000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 67500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 87500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 112500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 137500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 175000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_150k_200kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 162500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_200k_plusE)/(hh_with_mortgageE*0.01),
0)))))))))))))))),
county = word(NAME, 1)) %>%
rename(med_gross_rent = med_gross_rentE,
med_home_value = med_home_valueE) %>%
dplyr::select(county, owner_occ_hh_pct, renter_occ_hh_pct, renter_vacant_pct, med_age_home, med_home_value, internet_hh, rent_burdened_pct, mortgage_burdened_pct, med_gross_rent)
names(dat)[-1] %<>% paste0(yr)
return(dat)
}
dat_21 <- get_dat(2021)
View(dat_21)
get_dat <- function(yr){
dat <- get_acs(geography = "county",
variables = c("owner_occ_hh" = "B25011_002",
"total_hh" = "B11007_001",
"renter_occ_hh" = "B25003_003",
"hh_with_mortgage" = "B25096_002",
"income_below10k" = "B19101_002",
"income_10k_15k" = "B19101_003",
"income_15k_20k" = "B19101_004",
"income_20k_25k" = "B19101_005",
"income_25k_30k" = "B19101_006",
"income_30k_35k" = "B19101_007",
"income_35k_40k" = "B19101_008",
"income_40k_45k" = "B19101_009",
"income_45k_50k" = "B19101_010",
"income_50k_60k" = "B19101_011",
"income_60k_75k" = "B19101_012",
"income_75k_100k" = "B19101_013",
"income_100k_125k" = "B19101_014",
"income_125k_150k" = "B19101_015",
"income_150k_200k" = "B19101_016",
"income_200k_plus" = "B19101_017",
"vacant_rental_units" = "B25004_002",
"internet_hh" = "B28002_002",
"med_year_built" = "B25035_001",
"med_home_value" = "B25107_001",
"medhhinc" = "B19013A_001",
"med_owner_costs_mortgaged" = "B25088_002",
"med_gross_rent" = "B25064_001"), year = yr, state = "PA",
geometry = FALSE, survey = "acs5", output = "wide") %>%
mutate(owner_occ_hh_pct = ifelse(total_hhE > 0, round(100*owner_occ_hhE/total_hhE), 0),
renter_occ_hh_pct = ifelse(total_hhE > 0, round(100*renter_occ_hhE/total_hhE), 0),
renter_vacant_pct = ifelse(renter_occ_hhE > 0, round(100*vacant_rental_unitsE/renter_occ_hhE), 0),
med_age_home = yr-med_year_builtE,
internet_hh = ifelse(total_hhE > 0, round(100*internet_hhE/total_hhE), 0),
rent_burdened_pct = ifelse(med_gross_rentE*12 > 5000*.3, income_below10kE/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 12500*.3, (income_below10kE + income_10k_15kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 17500*.3, (income_below10kE + income_10k_15kE + income_15k_20kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 22500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 27500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 32500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 37500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 42500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 47500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 55000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 67500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 87500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 112500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 137500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 175000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_150k_200kE)/(renter_occ_hhE *0.01),
ifelse(med_gross_rentE*12 > 162500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_200k_plusE)/(renter_occ_hhE *0.01),
0)))))))))))))))),
mortgage_burdened_pct = ifelse(med_owner_costs_mortgagedE*12 > 5000*.3, income_below10kE/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 12500*.3, (income_below10kE + income_10k_15kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 17500*.3, (income_below10kE + income_10k_15kE + income_15k_20kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 22500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 27500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 32500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 37500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 42500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 47500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 55000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 67500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 87500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 112500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 137500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 175000*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_150k_200kE)/(hh_with_mortgageE*0.01),
ifelse(med_owner_costs_mortgagedE*12 > 162500*0.3, (income_below10kE + income_10k_15kE + income_15k_20kE + income_20k_25kE + income_25k_30kE + income_30k_35kE + income_35k_40kE + income_40k_45kE + income_45k_50kE + income_50k_60kE + income_60k_75kE + income_75k_100kE + income_100k_125kE + income_125k_150kE + income_200k_plusE)/(hh_with_mortgageE*0.01),
0)))))))))))))))),
county = word(NAME, 1)) %>%
rename(med_gross_rent = med_gross_rentE,
med_home_value = med_home_valueE) %>%
dplyr::select(county, owner_occ_hh_pct, renter_occ_hh_pct, renter_vacant_pct, med_age_home, med_home_value, internet_hh, rent_burdened_pct, mortgage_burdened_pct, med_gross_rent)
names(dat)[-1] %<>% paste0("_", yr)
return(dat)
}
dat_21 <- get_dat(2021)
View(dat_21)
dat21 <- get_dat(2021)
dat20 <- get_dat(2020)
dat19 <- get_dat(2019)
dat18 <- get_dat(2018)
dat17 <- get_dat(2017)
dat <- dat_21 %>%
left_join(dat_20, by = "county") %>%
left_join(dat_19, by = "county") %>%
left_join(dat_18, by = "county") %>%
left_join(dat_17, by = "county")
dat20 <- get_dat(2020)
dat <- dat21 %>%
left_join(dat20, by = "county") %>%
left_join(dat19, by = "county") %>%
left_join(dat18, by = "county") %>%
left_join(dat17, by = "county")
#### Census rural-urban by county
county <- st_read("/Users/annaduan/Library/CloudStorage/Box-Box/PHFA\ dashboard/data\ panels/2020_UA_COUNTY.xlsx") %>%
filter(Field1 == "42") %>%
mutate(rural = ifelse(as.numeric(Field22)/as.numeric(Field5) > 0.5, 1, 0)) %>%
dplyr::select(Field4, rural) %>%
rename(NAME = Field4)
#### Census rural-urban by county
county <- st_read("/Users/annaduan/Library/CloudStorage/Box-Box/PHFA\ dashboard/data\ panels/2020_UA_COUNTY.xlsx") %>%
filter(Field1 == "42") %>%
mutate(rural = ifelse(as.numeric(Field22)/as.numeric(Field5) > 0.5, 1, 0)) %>%
dplyr::select(Field4, rural) %>%
rename(county = Field4)
View(county)
#### Census rural-urban by county
rural <- st_read("/Users/annaduan/Library/CloudStorage/Box-Box/PHFA\ dashboard/data\ panels/2020_UA_COUNTY.xlsx") %>%
filter(Field1 == "42") %>%
mutate(rural = ifelse(as.numeric(Field22)/as.numeric(Field5) > 0.5, 1, 0)) %>%
dplyr::select(Field4, rural) %>%
rename(county = Field4)
#### County shapefiles
counties.sf <- counties(state = "PA")
View(counties.sf)
#### County shapefiles
counties.sf <- counties(state = "PA") %>%
dplyr::select("county" = "NAME")
#### Write panel ####
dat <- dat %>%
left_join(county, by = "county") %>%
left_join(counties.sf, by = "county") %>%
st_as_sf()
View(dat)
mapview(dat)
#### Write panel ####
dat <- dat %>%
left_join(county, by = "county") %>%
left_join(counties.sf, by = "county") %>%
st_as_sf() %>%
st_make_valid()
dat <- dat21 %>%
left_join(dat20, by = "county") %>%
left_join(dat19, by = "county") %>%
left_join(dat18, by = "county") %>%
left_join(dat17, by = "county")
#### Write panel ####
dat <- dat %>%
left_join(county, by = "county") %>%
left_join(counties.sf, by = "county") %>%
st_as_sf() %>%
st_make_valid()
st_write(dat, "phfa_dash_data_sept26.geojson")
#### Leaflet test run ####
dat <- st_read("/Users/annaduan/Library/CloudStorage/Box-Box/PHFA\ dashboard/data\ panels/phfa_dash_data_sept26.geojson") %>%
st_as_sf()
pal <- colorFactor("YlGnBu", dat$owner_occ_hh_pct_2021)
labs_dat <- sprintf(
"<strong>%s</strong><br/>
Home Ownership Rate $%s<sup></sup>",
dat$NAME, dat$owner_occ_hh_pct_21
) %>% lapply(htmltools::HTML)
labs_dat <- sprintf(
"<strong>%s</strong><br/>
Home Ownership Rate $%s<sup></sup>",
dat$NAME, dat$owner_occ_hh_pct_2021
) %>% lapply(htmltools::HTML)
labs_dat <- sprintf(
"<strong>%s</strong><br/>
Home Ownership Rate $%s<sup></sup>",
dat$county, dat$owner_occ_hh_pct_2021
) %>% lapply(htmltools::HTML)
leaflet(dat) %>%
addPolygons(fillColor = ~pal(owner_occ_hh_pct_2021),
weight = 2,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlightOptions = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE)
# ,
#  label = labs_dat,
#  labelOptions = labelOptions(
#    style = list("font-weight" = "normal", padding = "3px 8px"),
#    textsize = "15px",
#    direction = "auto")
)%>%
addProviderTiles(providers$CartoDB.Positron) %>%
# addControl(title, position = "topright") %>%
addLegend(pal = pal, values = ~owner_occ_hh_pct_2021, opacity = 0.7, title = "Home Ownership Rate<br/>by County (%)",
position = "bottomright")
leaflet(dat) %>%
addPolygons(fillColor = ~pal(owner_occ_hh_pct_2021),
weight = 2,
opacity = 1,
color = "white",
dashArray = "3",
fillOpacity = 0.7,
highlightOptions = highlightOptions(
weight = 5,
color = "#666",
dashArray = "",
fillOpacity = 0.7,
bringToFront = TRUE)
,
label = labs_dat,
labelOptions = labelOptions(
style = list("font-weight" = "normal", padding = "3px 8px"),
textsize = "15px",
direction = "auto")
)%>%
addProviderTiles(providers$CartoDB.Positron) %>%
# addControl(title, position = "topright") %>%
addLegend(pal = pal, values = ~owner_occ_hh_pct_2021, opacity = 0.7, title = "Home Ownership Rate<br/>by County (%)",
position = "bottomright")
View(census_vars)
vacant_rental <- st_read("/Users/annaduan/Library/CloudStorage/Box-Box/PHFA\ Affordability\ Study\ \(2022\)/PHFA\ dashboard/data\ panels/phfa_dash_data_sept26.geojson")
vacant_rental <- st_read("/Users/annaduan/Library/CloudStorage/Box-Box/PHFA Affordability Study (2022)/PHFA dashboard/data panels/phfa_dash_data_sept26.geojson")
View(vacant_rental)
